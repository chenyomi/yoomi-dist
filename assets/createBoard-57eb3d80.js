import{b as L}from"./request-8e1b1635.js";import{S as X,P as T,R as y,V as M,A as k,D as b,a as C,W as j,M as w,B as S,b as Y,c as f,d as v,e as E,E as I,C as P,O}from"./OrbitControls-6e5a6999.js";const Z={getStorage(h){return L("/sss/storage/pallet",h,"get")},getStorageMaterial(h){return L("/sss/storage/material",h,"post")},getStorageMaterialCheck(h){return L("/sss/storage/material/check",h,"post")}};class H{constructor(i){this.options={container:"#box",upper:{trawlBoardLengthX:800,trawlBoardLengthY:400,trawlBoardOffsetX:20,trawlBoardOffsetY:20,trawlBoardSiteSpaceX:10,trawlBoardSiteSpaceY:10,trawlBoardSiteLengthX:83,trawlBoardSiteLengthY:83,trawlBoardSiteX:8,trawlBoardSiteY:4,trawlBoardShape:1,trawlBoardThickness:3},materials:[],lower:{layerBoardLengthX:800,layerBoardLengthY:400,layerBoardThickness:5},L1X:500,L1Y:400,L1Z:-300,L2X:-500,L2Y:400,L2Z:-300,materialList:[]},this.animation=null,this.domBox=null,this.cardBox=null,this.scene=null,this.camera=null,this.controls=null,this.renderer=null,this.geos=[],this.init(),this.updata(i)}init(){this.cardBox=document.querySelector(this.options.container),this.scene=new X,this.camera=new T(75,this.cardBox.clientWidth/this.cardBox.clientHeight,.1,1e3),this.cardBox.addEventListener("click",i=>{i.preventDefault();var o=this.getIntersects(i.layerX,i.layerY);if(o.length>0){var e=o.filter(function(s){return s&&s.object})[0];if(e&&e.object&&e.object.userData.id){const s=this.options.materialList.findIndex(r=>r===e.object.userData.id);s==-1?(this.options.materialList.push(e.object.userData.id),e.object.material.color.set("#fde308")):(this.options.materialList.splice(s,1),e.object.material.color.set("#97b2c8")),this.onModalChange(this.options.materialList)}}},!1)}disWebGl(){cancelAnimationFrame(this.animation),this.animation=null,this.domBox.innerHTML="",this.controls=null,this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer=null,this.geos=[],this.options.materialList=[],this.scene.clear()}getIntersects(i,o){var e=new y,s=new M;let r=document.getElementById("box"),g=r.clientWidth,u=r.clientHeight,p=r.offsetTop,m=r.offsetLeft;return i=(i-m)/g*2-1,o=-((o-p)/u)*2+1,s.set(i,o),e.setFromCamera(s,this.camera),e.intersectObjects(this.scene.children,!0)}updata(i){this.theme=localStorage.getItem("theme");const o=new k(200);this.scene.add(o),o.position.x=-this.options.upper.trawlBoardLengthX/2-10,o.position.z=-this.options.upper.trawlBoardLengthY/2-10,o.position.y=this.options.upper.trawlBoardThickness,this.options=Object.assign(this.options,i);const e=new b(15658734,this.theme=="light"?2:1);e.position.set(this.options.L1X,this.options.L1Y,this.options.L1Z),this.scene.add(e);const s=new b(15658734,this.theme=="light"?2:1);s.position.set(this.options.L2X,this.options.L2Y,this.options.L2Z),this.scene.add(s);const r=new C(11184810,this.theme=="light"?3:2);this.scene.add(r),this.renderer=new j({antialias:!0}),this.renderer.setSize(this.cardBox.clientWidth,this.cardBox.clientHeight),this.renderer.setClearColor(0,0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.shadowMap.enabled=!0,this.camera.position.set(0,this.options.upper.trawlBoardLengthY,this.options.upper.trawlBoardLengthY);const g=new w(new S(this.options.upper.trawlBoardLengthX,this.options.upper.trawlBoardThickness,this.options.upper.trawlBoardLengthY),new Y({color:12834515,roughness:.3}));g.position.y=this.options.upper.trawlBoardThickness/2;const u=new w(new S(this.options.lower.layerBoardLengthX,this.options.lower.layerBoardThickness,this.options.lower.layerBoardLengthY),new f({color:13425629}));u.position.y=-this.options.lower.layerBoardThickness/2,this.scene.add(u);const p=new v().moveTo(0,0).lineTo(0,this.options.upper.trawlBoardLengthY).lineTo(this.options.upper.trawlBoardLengthX,this.options.upper.trawlBoardLengthY).lineTo(this.options.upper.trawlBoardLengthX,0).lineTo(0,0);for(let t=0;t<this.options.upper.trawlBoardSiteY;t++)for(let l=0;l<this.options.upper.trawlBoardSiteX;l++){const a=this.options.upper.trawlBoardOffsetX+(this.options.upper.trawlBoardSiteLengthX+this.options.upper.trawlBoardSiteSpaceX)*l+this.options.upper.trawlBoardSiteLengthX/2,c=this.options.upper.trawlBoardOffsetY+(this.options.upper.trawlBoardSiteLengthY+this.options.upper.trawlBoardSiteSpaceY)*t+this.options.upper.trawlBoardSiteLengthY/2,n=new E;this.options.upper.trawlBoardShape==0?(n.moveTo(a-this.options.upper.trawlBoardSiteLengthX/2,c-this.options.upper.trawlBoardSiteLengthY/2),n.lineTo(a+this.options.upper.trawlBoardSiteLengthX/2,c-this.options.upper.trawlBoardSiteLengthY/2),n.lineTo(a+this.options.upper.trawlBoardSiteLengthX/2,c+this.options.upper.trawlBoardSiteLengthY/2),n.lineTo(a-this.options.upper.trawlBoardSiteLengthX/2,c+this.options.upper.trawlBoardSiteLengthY/2),p.holes.push(n)):(n.absarc(a,c,this.options.upper.trawlBoardSiteLengthX/2,0,Math.PI*2,!1),p.holes.push(n))}let m=new I(p,{depth:this.options.upper.trawlBoardThickness,bevelEnabled:!1,curveSegments:50}),B=new w(m,new Y({color:12834515,roughness:.3}));B.position.set(-this.options.upper.trawlBoardLengthX/2,this.options.upper.trawlBoardThickness,-this.options.upper.trawlBoardLengthY/2),B.rotation.set(Math.PI/2,0,0),this.scene.add(B);let d=null;this.options.materials.forEach(t=>{t.materialShape==0?t.geo=[t.materialLengthX,t.materialLengthZ,t.materialLengthY]:t.materialShape==1&&(t.geo=[t.materialLengthX/2,t.materialLengthY/2,t.materialLengthZ]),t.pos=[t.centerPointX-this.options.upper.trawlBoardLengthX/2,t.materialLengthZ/2,t.centerPointY-this.options.upper.trawlBoardLengthY/2]}),this.options.materials.forEach(t=>{const l=this.options.materialList.some(a=>a==t.id);t.materialShape==0?d=new w(new S(...t.geo),new f({color:l?16638728:9941704})):t.materialShape==1&&(d=new w(new P(...t.geo),new f({color:l?16638728:9941704}))),d.userData={id:t.id},d.position.set(...t.pos),this.scene.add(d)});const x=()=>{this.animation=requestAnimationFrame(x),this.renderer.render(this.scene,this.camera)};this.controls=new O(this.camera,this.renderer.domElement),this.domBox=document.querySelector("#box"),this.renderer.domElement.setAttribute("class","fadeIn"),this.domBox.appendChild(this.renderer.domElement),x()}}export{H as c,Z as s};
